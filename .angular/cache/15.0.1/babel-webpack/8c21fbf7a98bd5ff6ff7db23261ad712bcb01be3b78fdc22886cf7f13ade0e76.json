{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/max_2/Desktop/angular/RHApp-new/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { HttpHeaders } from \"@angular/common/http\";\nimport { BehaviorSubject, Subject } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common/http\";\nconst httpOptions = {\n  headers: new HttpHeaders({\n    'Content-type': 'application/json',\n    //   'Authorization': 'Basic '+btoa('mehdy:mehdy'),\n    'Access-Control-Allow-Origin': '*'\n  })\n};\nexport class AuthService {\n  constructor(router, http) {\n    this.router = router;\n    this.http = http;\n    this.loggedIn = new BehaviorSubject(false);\n  }\n  get isLoggedIn() {\n    return this.loggedIn.asObservable();\n  }\n  login({\n    username,\n    password\n  }) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      let utilisateur = new Worker(username, password, \"\");\n      var subject = new Subject();\n      yield _this.http.post('http://localhost:3000/api/personnes', utilisateur, httpOptions).subscribe({\n        next: utilisateurCo => {\n          if (utilisateurCo) {\n            localStorage.setItem('ROLE', utilisateurCo.Fonction.nom);\n            _this.loggedIn.next(true);\n            subject.next(true);\n          } else {\n            _this.loggedIn.next(false);\n            subject.next(false);\n          }\n        },\n        error: error => {\n          console.log(\"error : \" + error);\n          _this.loggedIn.next(false);\n          subject.next(false);\n        }\n      });\n      return subject.asObservable();\n    })();\n  }\n  // login(username: string, password: string): boolean {\n  //     this.isLoggedIn = (username == 'max' && password == 'root');\n  //     return this.isLoggedIn\n  // }\n  logout() {\n    this.isLoggedIn = false;\n    this.router.navigate(['/login']);\n  }\n  static #_ = this.ɵfac = function AuthService_Factory(t) {\n    return new (t || AuthService)(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.HttpClient));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"mappings":";AAAA,SAAqBA,WAAW,QAAQ,sBAAsB;AAG9D,SAASC,eAAe,EAAcC,OAAO,QAAQ,MAAM;;;;AAE3D,MAAMC,WAAW,GAAG;EAChBC,OAAO,EAAE,IAAIJ,WAAW,CAAC;IACrB,cAAc,EAAE,kBAAkB;IAClC;IACA,6BAA6B,EAAE;GAClC;CACJ;AAKD,OAAM,MAAOK,WAAW;EAKpBC,YAAoBC,MAAc,EAAUC,IAAgB;IAAxC,WAAM,GAAND,MAAM;IAAkB,SAAI,GAAJC,IAAI;IAJxC,aAAQ,GAAG,IAAIP,eAAe,CAAU,KAAK,CAAC;EAIU;EAEhE,IAAIQ,UAAU;IACV,OAAO,IAAI,CAACC,QAAQ,CAACC,YAAY,EAAE;EACvC;EAEMC,KAAK,CAAC;IAAEC,QAAQ;IAAEC;EAAQ,CAA2C;IAAA;IAAA;MACvE,IAAIC,WAAW,GAAG,IAAIC,MAAM,CAACH,QAAQ,EAAEC,QAAQ,EAAE,EAAE,CAAC;MAAC,IAAIG,OAAO,GAAG,IAAIf,OAAO,EAAW;MACzF,MAAM,KAAI,CAACM,IAAI,CAACU,IAAI,CAAS,qCAAqC,EAAEH,WAAW,EAAEZ,WAAW,CAAC,CAACgB,SAAS,CAAC;QACtGC,IAAI,EAAIC,aAAa,IAAG;UACtB,IAAGA,aAAa,EAAC;YACfC,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEF,aAAa,CAACG,QAAQ,CAACC,GAAG,CAAC;YACxD,KAAI,CAACf,QAAQ,CAACU,IAAI,CAAC,IAAI,CAAC;YACxBH,OAAO,CAACG,IAAI,CAAC,IAAI,CAAC;WACnB,MAAM;YACL,KAAI,CAACV,QAAQ,CAACU,IAAI,CAAC,KAAK,CAAC;YACzBH,OAAO,CAACG,IAAI,CAAC,KAAK,CAAC;;QAEvB,CAAC;QACDM,KAAK,EAAIA,KAAK,IAAG;UACfC,OAAO,CAACC,GAAG,CAAC,UAAU,GAACF,KAAK,CAAC;UACzB,KAAI,CAAChB,QAAQ,CAACU,IAAI,CAAC,KAAK,CAAC;UACzBH,OAAO,CAACG,IAAI,CAAC,KAAK,CAAC;QACzB;OACD,CACA;MACD,OAAOH,OAAO,CAACN,YAAY,EAAE;IAAC;EAChC;EAIF;EACA;EACA;EACA;EAEAkB,MAAM;IACF,IAAI,CAACpB,UAAU,GAAG,KAAK;IACvB,IAAI,CAACF,MAAM,CAACuB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;EACpC;EAAC;qBA5CQzB,WAAW;EAAA;EAAA;WAAXA,WAAW;IAAA0B,SAAX1B,WAAW;IAAA2B,YAFR;EAAM","names":["HttpHeaders","BehaviorSubject","Subject","httpOptions","headers","AuthService","constructor","router","http","isLoggedIn","loggedIn","asObservable","login","username","password","utilisateur","Worker","subject","post","subscribe","next","utilisateurCo","localStorage","setItem","Fonction","nom","error","console","log","logout","navigate","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\max_2\\Desktop\\angular\\RHApp-new\\src\\app\\auth.service.ts"],"sourcesContent":["import { HttpClient, HttpHeaders } from \"@angular/common/http\";\r\nimport { Injectable } from \"@angular/core\";\r\nimport { Router } from \"@angular/router\";\r\nimport { BehaviorSubject, Observable, Subject } from \"rxjs\";\r\n\r\nconst httpOptions = {\r\n    headers: new HttpHeaders({\r\n        'Content-type': 'application/json',\r\n        //   'Authorization': 'Basic '+btoa('mehdy:mehdy'),\r\n        'Access-Control-Allow-Origin': '*',\r\n    })\r\n}\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n    private loggedIn = new BehaviorSubject<boolean>(false);\r\n    // isLoggedIn: boolean = false;\r\n    roleAs: string | null | undefined;\r\n\r\n    constructor(private router: Router, private http: HttpClient) { }\r\n\r\n    get isLoggedIn() {\r\n        return this.loggedIn.asObservable();\r\n    }\r\n\r\n    async login({ username, password }: { username: string; password: string; }): Promise<Observable<boolean>> {\r\n        let utilisateur = new Worker(username, password, \"\");var subject = new Subject<boolean>();\r\n        await this.http.post<Worker>('http://localhost:3000/api/personnes', utilisateur, httpOptions).subscribe({\r\n          next : (utilisateurCo)=>{\r\n            if(utilisateurCo){\r\n              localStorage.setItem('ROLE', utilisateurCo.Fonction.nom) \r\n              this.loggedIn.next(true);\r\n              subject.next(true); \r\n            } else {          \r\n              this.loggedIn.next(false); \r\n              subject.next(false); \r\n            }\r\n          },\r\n          error : (error)=>{ \r\n            console.log(\"error : \"+error)\r\n                this.loggedIn.next(false);  \r\n                subject.next(false); \r\n          }\r\n        }\r\n        )\r\n        return subject.asObservable();\r\n      }\r\n\r\n\r\n\r\n    // login(username: string, password: string): boolean {\r\n    //     this.isLoggedIn = (username == 'max' && password == 'root');\r\n    //     return this.isLoggedIn\r\n    // }\r\n\r\n    logout() {\r\n        this.isLoggedIn = false;\r\n        this.router.navigate(['/login'])\r\n    }\r\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}